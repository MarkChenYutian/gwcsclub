I"ê#<h2 id="1712s3-the-bovine-shuffle">1712s3 The Bovine Shuffle</h2>

<blockquote>
  <p>é¢˜ç›®å¤§æ„ï¼šä¸€ç¾¤ç‰›æŒ‰ä»¥ä¸‹è§„åˆ™è·³èˆï¼šæ¯ä¸€æ¬¡ç§»åŠ¨ï¼Œä½ç½®iä¸Šçš„ç‰›ç§»åŠ¨åˆ°ä½ç½®next(i)ï¼Œå¦‚æœæœ‰å¤šå¤´ç‰›ç§»åŠ¨åˆ°åŒä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€æ¬¡ç§»åŠ¨æ—¶è¿™äº›ç‰›ä¸€èµ·ç§»åŠ¨ã€‚å·²çŸ¥æ‰€æœ‰çš„f(i)ï¼Œè¯·æ±‚å‡ºæ— è®ºæ€ä¹ˆç§»åŠ¨éƒ½æœ‰ç‰›çš„ä½ç½®çš„æ•°é‡ã€‚</p>
</blockquote>

<h4 id="æ€è·¯">æ€è·¯ï¼š</h4>

<p>ç”¨ä¸€ä¸ªæ•°ç»„è®°å½•ä¸‹æ¬¡ä¼šç§»åŠ¨åˆ°æ¯ä¸€ä¸ªiçš„ä½ç½®æ•°é‡count(i)ï¼Œå¦‚æœæ²¡æœ‰ä½ç½®å°†ç§»åŠ¨åˆ°è¿™ä¸ªä½ç½®(ä¹Ÿå°±æ˜¯count(i)=0)ï¼Œé‚£ä¹ˆä¸‹æ¬¡ç§»åŠ¨åè¿™é‡Œå°†æ²¡æœ‰ç‰›ã€‚ç‰¹æ®Šæ ‡è®°è¿™ä¸ªä½ç½®ï¼Œå¹¶ä½¿next(i)çš„countæ•°-1ï¼ˆå› ä¸ºä»ä¸‹æ¬¡èµ·ï¼Œä¼šç§»åŠ¨åˆ°è¿™é‡Œçš„ä½ç½®æ•°é‡å°‘äº†1ï¼‰ï¼Œå¹¶æ£€æŸ¥è¿™ä¸ªä½ç½®çš„countæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0ï¼Œé‡å¤è¿™å¥è¯çš„æ“ä½œã€‚æ¯æ¬¡éå†æ•°ç»„ï¼Œæ‰¾å‡ºcount(i)ä¸º0çš„iå°±å¯ä»¥äº†ï¼Œç›´åˆ°æ²¡æœ‰ä¸º0çš„iå°±å¯ä»¥äº†ã€‚
ä¸ºäº†æ›´å¿«åœ°æ‰¾å‡ºcount(i)ä¸º0çš„iï¼Œå¯ä»¥å…ˆå°†æ‰€æœ‰count(i)ä¸º0çš„iè£…è¿›ä¸€ä¸ªæ ˆï¼Œæ¯æ¬¡ä»ä¸­popå‡ºä¸€ä¸ªå€¼å³å¯ã€‚</p>

<h4 id="å¤æ‚åº¦">å¤æ‚åº¦ï¼š</h4>

<p>éå†æ•°ç»„ï¼Œæ‰¾å‡ºcount(i)ä¸º0çš„ç‚¹ï¼Œå¹¶è£…è¿›æ ˆé‡Œï¼Œä¸ºO(n)
æ¯æ¬¡popå‡ºä¸€ä¸ªiï¼Œå¦‚æœcount(i)æ²¡æœ‰è¢«ç‰¹æ®Šæ ‡è®°ï¼Œåˆ™ä½¿count(next(i))â€“ï¼Œå¹¶pushè¿›next(i)ï¼Œä¸ºO(1)ï¼Œæœ€å¤šnæ¬¡ã€‚
æ€»çš„ä¸ºO(n)</p>

<h4 id="å®ç°">å®ç°ï¼š</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TheBovineShuffle1712s3</span><span class="o">{</span>
    <span class="kd">static</span> <span class="kt">int</span><span class="o">[]</span><span class="n">counts</span><span class="o">;</span>
    <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>
    <span class="kd">static</span> <span class="kt">int</span><span class="o">[]</span><span class="n">nexts</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span><span class="n">args</span><span class="o">)</span><span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
        <span class="nc">BufferedReader</span> <span class="n">in</span><span class="o">=</span><span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileReader</span><span class="o">(</span><span class="s">"shuffle.in"</span><span class="o">));</span>
        <span class="nc">PrintWriter</span> <span class="n">out</span><span class="o">=</span><span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileWriter</span><span class="o">(</span><span class="s">"shuffle.out"</span><span class="o">)));</span>
        <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">());</span>
        <span class="n">count</span><span class="o">=</span><span class="n">n</span><span class="o">;</span>
        <span class="nc">StringTokenizer</span> <span class="n">st</span><span class="o">=</span><span class="k">new</span> <span class="nc">StringTokenizer</span><span class="o">(</span><span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">());</span>
        <span class="n">nexts</span><span class="o">=</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">];</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="n">nexts</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">nextToken</span><span class="o">())-</span><span class="mi">1</span><span class="o">;</span>
        <span class="n">counts</span><span class="o">=</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">];</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="n">counts</span><span class="o">[</span><span class="n">nexts</span><span class="o">[</span><span class="n">i</span><span class="o">]]++;</span>
        <span class="nc">Stack</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span><span class="n">to</span><span class="o">=</span><span class="k">new</span> <span class="nc">Stack</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="k">if</span><span class="o">(</span><span class="n">counts</span><span class="o">[</span><span class="n">i</span><span class="o">]==</span><span class="mi">0</span><span class="o">)</span> <span class="n">to</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">to</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
            <span class="kt">int</span> <span class="n">ind</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="n">ind</span><span class="o">!=-</span><span class="mi">2</span><span class="o">){</span>
                <span class="k">if</span><span class="o">(</span><span class="n">counts</span><span class="o">[</span><span class="n">ind</span><span class="o">]==</span><span class="mi">0</span><span class="o">){</span>
                    <span class="n">counts</span><span class="o">[</span><span class="n">ind</span><span class="o">]=-</span><span class="mi">1</span><span class="o">;</span>
                    <span class="n">count</span><span class="o">--;</span>
                    <span class="n">counts</span><span class="o">[</span><span class="n">nexts</span><span class="o">[</span><span class="n">ind</span><span class="o">]]--;</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">counts</span><span class="o">[</span><span class="n">nexts</span><span class="o">[</span><span class="n">ind</span><span class="o">]]==</span><span class="mi">0</span><span class="o">){</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">nexts</span><span class="o">[</span><span class="n">ind</span><span class="o">];</span>
                        <span class="k">continue</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">to</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="k">break</span><span class="o">;</span>
                    <span class="n">ind</span><span class="o">=</span><span class="n">to</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">count</span><span class="o">);</span>
        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

:ET